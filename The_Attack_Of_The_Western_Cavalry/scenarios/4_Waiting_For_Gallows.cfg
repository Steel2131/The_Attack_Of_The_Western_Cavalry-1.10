#textdomain wesnoth-did
[scenario]
    id=4_Waiting_For_The_Gallows
    name=_ "Waiting for the Gallows"
    next_scenario=5_The_Call_Of_Necromancy
    map_data="{~add-ons/The_Attack_Of_The_Western_Cavalry/maps/4_Waiting_For_Gallows.map}"
#ifdef EASY
    turns=45
#endif
#ifdef HARD
    turns=60
#endif
    victory_when_enemies_defeated=no



    {UNDERGROUND}
    {~add-ons/The_Attack_Of_The_Western_Cavalry/utils/summarise_no_deaths.cfg}

    [story]
        [part]
            story= _ "Aethyr was taken into the prison after he had been sentenced to be hanged by the neck until death."
            background=story/darkness.png
            music=elvish-theme.ogg
            show_title=yes
        [/part]
        [part]
            story= _ "At night, he had a visitor..."
            background=story/darkness.png
            show_title=yes
        [/part]
    [/story]

    [side]
        gold=0
        income=-2
        type=Western Knight
        id=Aethyr
        name= _ "Aethyr"
        unrenamable=yes
        profile="portraits/aethyr.png"
        side=1
        canrecruit=yes
        controller=human
        recruit=Prisoner
        team_name=Westerns
        user_team_name=_"Western Cavalry"
        {FLAG_CAVALRY}
        fog=no
        shroud=yes
    [/side]
    [side]
        no_leader=yes
        side=2
        canrecruit=yes
        controller=ai
        recruit=Walking Corpse
        team_name=Elensefar
        user_team_name=_"Guards"
        fog=no
        shroud=no
    [/side]
    [side]
        no_leader=yes
        side=3
        canrecruit=no
        controller=ai
        team_name=Westerns
        user_team_name=_"Prisoners"
        fog=no
        shroud=yes
    [/side]

    [event]
        name=prestart

        [objectives]
            side=1
            [objective]
                condition=win
                description=_ "Escape from the prison alive"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Aethyr"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of any important prisoner (they have hero icon)"
            [/objective]
            [objective]
                condition=lose
                description=_ "Run out of time"
            [/objective]
        [/objectives]

        #########
        ##DOORS##
        #########
        # door-se
        [item]
            image=scenery/gate-rusty-se.png
            x,y=16,15
        [/item]
        [item]
            image=scenery/gate-rusty-se.png
            x,y=8,17
        [/item]
        [item]
            image=scenery/gate-rusty-se.png
            x,y=22,13
        [/item]
        [item]
            image=scenery/gate-rusty-se.png
            x,y=11,9
        [/item]
        [item]
            image=scenery/gate-rusty-se.png
            x,y=16,6
        [/item]
        [item]
            image=scenery/gate-rusty-se.png
            x,y=20,4
        [/item]
        [item]
            image=scenery/gate-rusty-se.png
            x,y=17,4
        [/item]
        [item]
            image=scenery/gate-rusty-se.png
            x,y=9,4
        [/item]
        [item]
            image=scenery/gate-rusty-se.png
            x,y=13,6
        [/item]
 
        # door-sw

        [item]
            image=scenery/gate-rusty-sw.png
            x,y=24,16
        [/item]
        [item]
            image=scenery/gate-rusty-sw.png
            x,y=7,15
        [/item]
        [item]
            image=scenery/gate-rusty-sw.png
            x,y=26,13
        [/item]
        [item]
            image=scenery/gate-rusty-sw.png
            x,y=14,11
        [/item]
        [item]
            image=scenery/gate-rusty-sw.png
            x,y=6,9
        [/item]
        [item]
            image=scenery/gate-rusty-sw.png
            x,y=25,8
        [/item]
        [item]
            image=scenery/gate-rusty-sw.png
            x,y=26,4
        [/item]
        [item]
            image=scenery/gate-rusty-sw.png
            x,y=22,2
        [/item]

        ###########
        ##WEAPONS##
        ###########

        [item]
            image=items/spear-fancy.png
            x,y=28,1
        [/item]
        [item]
            image=items/cloak-green.png
            x,y=27,1
        [/item]
        [item]
            image=items/armor.png
            x,y=30,2
        [/item]
        [item]
            image=items/staff-magic.png
            x,y=30,3
        [/item]





        # TODO: some scanary

        [item]
            image=scenery/slab1.png
            x,y=16,18
        [/item]
        [item]
            image=items/book3.png
            x,y=3,11
        [/item]
        [item]
            image=items/altar-turned.png
            x,y=4,10
        [/item]
        [item]
            image=items/altar.png
            x,y=10,18
        [/item]
        [item]
            image=items/book3.png
            x,y=11,19
        [/item]
        [item]
            image=items/chest.png
            x,y=12,18
        [/item]

        # Aethyr as a prisoner
        [store_unit]
            [filter]
                id=Aethyr
            [/filter]

            kill=yes
            variable=stored_Aethyr
        [/store_unit]
        [unit]
            id=Aethyr
            name= _ "Aethyr"
            type=Prisoner
            side=1
            x,y=16,18
            [modifications]
                {TRAIT_STRONG}
            [/modifications]
            experience=$stored_Aethyr.experience
            profile=portraits/prisoners/aethyr-prisoner.png
            overlays=misc/leader.png
        [/unit]

        {MODIFY_UNIT (id=Aethyr) canrecruit yes}

        [unit]
            id=Arya
            name= _ "Arya"
            unrenamable=yes
            type=Elvish Halberdier
            profile="portraits/arya.png"
            experience=42
            side=2
            {IS_HERO}
            x=16
            y=13
            ai_special=guardian
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_MIGHTY}
            [/modifications]
        [/unit]
        [unit]
            id=Jail
            name= _ "Jail Master"
            unrenamable=yes
            type=Dark Sorcerer
            profile="portraits/jail-master.png"
            side=2
            {IS_LOYAL}
            x=16
            y=14
            ai_special=guardian
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
				#{TRAIT_EVIL}
            [/modifications]
        [/unit]

        #############
        ##VARIABLES##
        #############

        {VARIABLE Key 0}
        {VARIABLE Prisoner 0}
        {VARIABLE Aethyr 0}
        {VARIABLE Warwick 0}
        {VARIABLE earth 0}
    [/event]

    {CORPSES (
        {NOT id=Arya}
        {NOT id=Jail}
        {NOT id=Money}
        {NOT id=Keykeeper}
        {NOT side=1}
    )}



    {ANIMATED_BRAZIER 19 19}
    {ANIMATED_BRAZIER 29 12}
    {ANIMATED_BRAZIER 22 1}
    {ANIMATED_BRAZIER 14 3}
    {ANIMATED_BRAZIER 27 3}
    {ANIMATED_BRAZIER 20 7}
    {ANIMATED_BRAZIER 11 7}
    {ANIMATED_BRAZIER 3 10}
    {ANIMATED_BRAZIER 11 15}
    {ANIMATED_BRAZIER 5 15}
    {ANIMATED_BRAZIER 9 19}





    [event]
        name=start

	{DELETE_SIDE_GOLD 1}

        [kill]
            [not]
                id=Aethyr
            [/not]
            [not]
                id=Arya
            [/not]
            [not]
                id=Jail
            [/not]
        [/kill]

        ##########
        ##Guards##
        ##########

        [unit]
            type=Walking Corpse
            side=2
            {IS_LOYAL}
            x=23
            y=11
            ai_special=guardian
        [/unit]
        [unit]
            id=Door1
            type=Woodsman
            side=2
            {IS_LOYAL}
            x=25
            y=6
            ai_special=guardian
        [/unit]
        [unit]
            type=Bowman
            side=2
            {IS_LOYAL}
            x=21
            y=3
            ai_special=guardian
        [/unit]
        [unit]
            type=Spearman
            side=2
            {IS_LOYAL}
            x=19
            y=8
            ai_special=guardian
        [/unit]
        [unit]
            type=Walking Corpse
            side=2
            {IS_LOYAL}
            x=18
            y=8
            ai_special=guardian
        [/unit]
        [unit]
            type=Soulless
            side=2
            {IS_LOYAL}
            x=13
            y=13
            ai_special=guardian
        [/unit]
        [unit]
            type=Walking Corpse
            side=2
            {IS_LOYAL}
            x=14
            y=13
            ai_special=guardian
        [/unit]
#ifdef EASY
        [unit]
            id=Keykeeper
            type=Swordsman
            side=2
            {IS_LOYAL}
            x=17
            y=2
            ai_special=guardian
        [/unit]
        [unit]
            id=Money
            type=Halberdier
            side=2
            {IS_LOYAL}
            x=10
            y=4
            ai_special=guardian
        [/unit]
#endif
#ifdef HARD
        [unit]
            type=Walking Corpse
            side=2
            {IS_LOYAL}
            x=22
            y=10
            ai_special=guardian
        [/unit]
        [unit]
            type=Bowman
            side=2
            {IS_LOYAL}
            x=20
            y=3
            ai_special=guardian
        [/unit]
        [unit]
            id=Keykeeper
            type=Swordsman
            side=2
            {IS_LOYAL}
            x=17
            y=2
            ai_special=guardian
        [/unit]
        [unit]
            type=Spearman
            side=2
            {IS_LOYAL}
            x=18
            y=1
            ai_special=guardian
        [/unit]
        [unit]
            type=Peasant
            side=2
            {IS_LOYAL}
            x=19
            y=9
            ai_special=guardian
        [/unit]        
        [unit]
            type=Woodsman
            side=2
            {IS_LOYAL}
            x=15
            y=14
            ai_special=guardian
        [/unit]      
        [unit]
            id=Money
            type=Swordsman
            side=2
            {IS_LOYAL}
            x=10
            y=4
            ai_special=guardian
        [/unit]
#endif

        #########
        ##START##
        #########
        [scroll_to] 
            x,y=16,18
        [/scroll_to]
        [delay]
            time=150
        [/delay]

        [remove_item]
            x,y=16,15
        [/remove_item]

        [redraw]
        [/redraw]

        [sound]
            name=flail-miss.ogg
        [/sound]

        [delay]
            time=400
        [/delay]

        {MOVE_UNIT id=Jail 16 17}


        [message]
            speaker=Jail
            message= _ "Hahaha! You would sleep through your own hanging, I suppose."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "Well, if I may, these cells ar so boring that you won't need to hang me. I'm sick to death with them."
        [/message]
        [message]
            speaker=Jail
            message= _ "Very funny. But don't die yet. You have a visitor."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "Who is it?"
        [/message]
        [message]
            speaker=Jail
            message= _ "I think you might know her."
        [/message]

        {MOVE_UNIT id=Arya 16 16}
        {MOVE_UNIT id=Arya 15 17}

        [message]
            speaker=Aethyr
            message= _ "You again? I think you came to explain me some things."
        [/message]
        [message]
            speaker=Arya
            message= _ "Look, firstly, I did not mean to hurt you."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "What the hell? Yesterday, if I remember correctly, you got my head kicked! And today, you don't mean to hurt me!"
        [/message]
        [message]
            speaker=Arya
            message= _ "If I hadn't gotten the swordsman to kick you, you would have been killed."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "That's right, but for what? I'm being hanged tomorrow anyway."
        [/message]
        [message]
            speaker=Arya
            message= _ "At Aldril, you saved my life. For what, I could ask."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "*<i>upstely turns away</i>*"
        [/message]
        [message]
            speaker=Arya
            message= _ "Lawrence wanted to kill all of us, didn't he? And he forced you to occupy Elensefar, and your only ask was that I mustn't be hurt. So?"
        [/message]
        [message]
            speaker=Aethyr
            message= _ "*<i>avoiding the question</i>* How did you escape?"
        [/message]
        [message]
            speaker=Arya
            message= _ "The king of Wesnoth is extremely angry. He is raising hosts against Lawrence. If I'm correct, Aldril will be under blocade in a few days. Although I'm not sure he'll succeed - Lawrence shows to be strong. 
A spy freed me, during the night."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "Not good...your king should be more wary."
        [/message]
        [message]
            speaker=Arya
            message= _ "Be sure, he's wary enough. So, I answered your question, it's your turn. Why did you protect me?"
        [/message]
        [message]
            speaker=Aethyr
            message= _ "I've said I don't know! Okay, I liked you a bit, so it was courtesy!"
        [/message]
        [delay]
            time=600
        [/delay]
        [message]
            speaker=Arya
            message= _ "You Westerns are strange..."
        [/message]
        [message]
            speaker=Arya
            message= _ "Okay, I think I'll be going, the sun is rising."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "WHAT? Now you're just...leaving and letting me die on the gallows?"
        [/message]
        [message]
            speaker=Arya
            message= _ "You're a Western, right? That's what you deserve."
        [/message]
  
        {MOVE_UNIT id=Jail 17 16}

        [message]
            speaker=Jail
            message= _ "Exactly. Bad bye, little being-in-love western knightie."
        [/message]

        {MOVE_UNIT id=Jail 14 14}
        {MOVE_UNIT id=Arya 16 16}

        [item]
            image=items/leather-pack.png
            x,y=16,16
        [/item]

        [redraw]
        [/redraw]

        [message]
            speaker=Arya
            message= _ "Oups, I dropped something! *<i>smiles</i>* Oh, just my handkerchief, never mind about it."
        [/message]

        {MOVE_UNIT id=Arya 16 13}

        [item]
            image=scenery/gate-rusty-se.png
            x,y=16,15
        [/item]
        
        [redraw]
        [/redraw]
        
        [message]
            speaker=Aethyr
            message= _ "Pff...but at least they forgot to handcuff me."
        [/message]

        [teleport]
            [filter]
                id=Arya
            [/filter]
            x,y=9,2
        [/teleport]
        [teleport]
            [filter]
                id=Jail
            [/filter]
            x,y=11,19
        [/teleport]
        {MODIFY_UNIT x,y=11,19 facing nw}
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=16
            y=16
        [/filter]
        [remove_item]
            x,y=16,16
        [/remove_item]

        [redraw]
        [/redraw]
        
        [message]
            speaker=Aethyr
            message= _ "Wow! It's not just a handkerchief!"
        [/message]
        [message]
            speaker=narrator
            image=items/key.png
            message= _ "As you unfold the packet, you find a key and a short text which may have been plucked out of a book:"
        [/message]
        [message]
            speaker=narrator
            image=items/book1.png
            message= _ "Below the book texts, you find something that was written by hand: 
'We mustn't speak totally honestly at the moment in the front of the jail master. Get out, and make right decisions. See you.
P.S: Wathch out for the guards! In case you got injured, rest a little, you will start healing.'"
        [/message]
        [message]
            speaker=Aethyr
            message= _ "Get out? I have only a few ours till dawn! Let's see if that key works!"
        [/message]

		[sound]
			name=brokeng.wav
		[/sound]

        [delay]
            time=1000
        [/delay]

        [message]
            speaker=Aethyr
            message= _ "Oh, I almost broke it. Mm...let's see the another door!"
        [/message]

        {VARIABLE Key 1}
    [/event]



    ##################
    ##Open the doors##
    ##################

    # DOOR 1
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=23-24
            y=17
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=24,16
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=24,16
                [/terrain]

                [redraw]
                [/redraw]

                {VARIABLE Key 2}
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=23-24
            y=17
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=0
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "You don't have the proper key to this door."
                [/message]
            [/then]
        [/if]
    [/event]

   
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Aethyr
            x=22,23,24,25,26,27,23,24,25,26,27,28,24,25,26,27,28,29
            y=14,14,15,15,16,16,14,14,15,15,16,16,13,14,14,15,15,16
        [/filter]
        [if]
            [variable]
                name=Prisoner
                numerical_equals=0
            [/variable]
            [then]
                [unit]
                    id=Warwick
                    name= _ "Warwick"
                    unrenamable=yes
                    type=Prisoner
                    profile="portraits/prisoners/warwick-prisoner.png"
                    side=3
                    {IS_HERO}
                    x=28
                    y=12
                    [modifications]
                        {TRAIT_LOYAL}
                        {TRAIT_STRONG}
                    [/modifications]
                [/unit]

                [redraw]
                    side=1
                [/redraw]
                [redraw]
                    side=3
                [/redraw]

                [message]
                    speaker=Warwick
                    message= _ "Hi there mate! I don't know how did get out of your cell, but I think we don't have too much time."
                [/message]
                [message]
                    speaker=Aethyr
                    message= _ "Hello. My name is Aethyr. I got the keys. Look, I am being hanged tomorrow morning, I really need to escape. Do you know this prison?"
                [/message]
                [message]
                    speaker=Warwick
                    message= _ "Ah, how impolite I am. I'm Warwick, a disawowed sergeant. Yes, I know this cave, but I can't help you if you don't let me out. If you get my meaning..."
                [/message]
                [message]
                    speaker=Aethyr
                    message= _ "The enemies of Wesnoth are our friends! I'll open the door."
                [/message]

                {VARIABLE Prisoner 1}
            [/then]
        [/if]
    [/event]


    # DOOR 2
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=25-26
            y=14
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=2
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=26,13
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=26,13
                [/terrain]

                [redraw]
                [/redraw]

                {VARIABLE Key 3}

                {MODIFY_UNIT (id=Warwick) side 1}

                [message]
                    speaker=Warwick
                    message= _ "Loads of thanks, mate. If we continue this way, we'll turn up at the weapon magazine."
                [/message]
                [message]
                    speaker=Aethyr
                    message= _ "That will be perfect."
                [/message]

                [label]
                    x,y=28,3
                    text="Weapon Magazine"
                    visible_in_shroud=yes
                [/label]
            [/then]
        [/if]
    [/event]

    
    # DOOR 3
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=22-23
            y=14
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=3
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=22,13
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=22,13
                [/terrain]

                [redraw]
                [/redraw]

                {VARIABLE Key 4}
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=22-23
            y=14
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=2
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "It would be too hazardous to continue your escape without a leader. You should let Warwick out first."
                [/message]
            [/then]
        [/if]
    [/event]


    # DOOR 4
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=24,25
            y=8,9
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=4
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=25,8
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=25,8
                [/terrain]

                [redraw]
                [/redraw]

                {VARIABLE Key 5}
            [/then]
        [/if]
    [/event]


    # DOOR 5
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=25-26
            y=5
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=5
            [/variable]
            [and]
            [have_unit]
                side=2
                [not]
                    id=Door1
                [/not]
            [/have_unit]
            [/and]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=26,4
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=26,4
                [/terrain]

                [redraw]
                [/redraw]
                [redraw]
                   side=1
                [/redraw]

                {VARIABLE Key 6}

                [message]
                    speaker=Warwick
                    message= _ "Here we are! Let's see...there's armour and glaive for me, and there's a spear and a light armor for you."
                [/message]
            [/then]
        [/if]
    [/event]


    
    # DOOR 6
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=21
            y=5
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=6
            [/variable]
            [and]
            [variable]
                name=Aethyr
                numerical_equals=2
            [/variable]
            [/and]
            [and]
            [variable]
                name=Warwick
                numerical_equals=2
            [/variable]
            [/and]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=20,4
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=20,4
                [/terrain]

                [redraw]
                [/redraw]

                {VARIABLE Key 7}
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=21
            y=5
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=6
            [/variable]
            [and]
            [variable]
                name=Aethyr
                less_than=2
            [/variable]
            [/and]
            [or]
            [variable]
                name=Warwick
                less_than=2
            [/variable]
            [/or]
            [then]
                [message]
                    speaker=narrator
                    image=items/armor.png
                    message= _ "You are not equipted properly."
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x=17,18,19,20,21
            y=5,4,4,3,3
        [/filter]
        [unit]
            id=Erwin
            name= _ "Erwin"
            unrenamable=yes
            type=Prisoner
            profile="portraits/prisoners/erwin-prisoner.png"
            side=3
            {IS_LOYAL}
            x=24
            y=1
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
        [/unit]

        [redraw]
            side=1
        [/redraw]
        [redraw]
            side=3
        [/redraw] 

        [message]
            speaker=Erwin
            message= _ "Please! Open the door! I know where the other key is hidden!"
        [/message]
    [/event]


    # DOOR 7
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=21
            y=3
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=7
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
  
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=22,2
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=22,2
                [/terrain]

                [redraw]
                [/redraw]
                [redraw]
                    side=1
                [/redraw]

                [message]
                    speaker=Erwin
                    message= _ "Thank you very much! You can't enter the hall with this key. The proper one is guarded by a swordsman at the Guard Room."
                [/message]

                [label]
                    text="Guard Room"
                    x,y=16,2
                    visible_in_shroud=yes
                [/label]
                [label]
                    text="The Hall"
                    x,y=17,8
                    visible_in_shroud=yes
                [/label]
                    

                {MODIFY_UNIT (id=Erwin) side 1}
                {VARIABLE Prisoner 2}
                {VARIABLE Key 8}
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x=21
            y=3
        [/filter]
        [if]
            [variable]
                name=Key
                greater_than_equal_to=9
            [/variable]
            [and]
            [variable]
                name=Prisoner
                numerical_not_equals=2
            [/variable]
            [/and]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
  
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=22,2
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=22,2
                [/terrain]

                [redraw]
                [/redraw]
                [redraw]
                    side=1
                [/redraw]

                [message]
                    speaker=Erwin
                    message= _ "Thank you very much! When you turned around I almost thought you will leave me there to die!"
                [/message]
                {MODIFY_UNIT (id=Erwin) side 1}
                {VARIABLE Prisoner 2}
            [/then]
        [/if]
    [/event]


    # DOOR 8
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=18
            y=4
        [/filter]
        [if]
            [variable]
                name=Key
                less_than=9
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
  
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=17,4
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=17,4
                [/terrain]

                [redraw]
                [/redraw]
                [redraw]
                    side=1
                [/redraw]
                
                [if]
                    [variable]
                        name=Key
                        numerical_equals=7
                    [/variable]
                    [then]
                        [message]
                            speaker=unit
                            message= _ "Oups, a swordsman! He's got the key!"
                        [/message]

                        {VARIABLE Key 9}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=Key
                        numerical_equals=8
                    [/variable]
                    [then]
                       [message]
                            speaker=unit
                            message= _ "There he is! He's not listenning! I'll kick him off."
                       [/message] 
                       
                       [delay]
                           time=200
                       [/delay]
                       [sound]
                           name=axe.ogg
                       [/sound]
                       [kill]
                           id=Keykeeper
                           animate=yes
                           fire_event=no
                       [/kill]
                       [delay]
                           time=200
                       [/delay]

                       [message]
                            speaker=unit
                            message= _ "That's it. He dropped the keys.."
                       [/message] 

                       [item]
                           image=items/key.png
                           x,y=17,2
                       [/item]
                   [/then]
                [/if]
                       
                {VARIABLE earth 1}
                {VARIABLE Key 9}
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        [filter]
            side=1
            x=17
            y=2
        [/filter]
        [if]
            [variable]
                name=earth
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=unit
                    message= _ "We have the new keys!"
                [/message]  

                [remove_item]
                    x,y=17,2
                [/remove_item]

                {VARIABLE Key 10}
                {VARIABLE earth 0}
            [/then]
        [/if]
    [/event]               
    [event]
        name=last breath
        [filter]
            id=Keykeeper
        [/filter]
        [message]
            speaker=Keykeeper
            message= _ "You defeated me, but you will never get out of the prison! I have no doubt about that you will be hanged tomorrow."
        [/message]  
        [message]
            speaker=Aethyr
            message= _ "Oh, please forgive me if I don't waste my remaining time."
        [/message]  
        [store_unit]
            [filter]
                id=Keykeeper
            [/filter]
            
            kill=yes
            variable=keykeeper_stored
        [/store_unit]
    
        [item]
            x,y=$keykeeper_stored.x,$keykeeper_stored.y
            image=items/key.png
        [/item]

        [delay]
            time=200
        [/delay]
        [message]
            speaker=Aethyr
            message= _ "He dropped the keys!"
        [/message]  
            
        {VARIABLE earth 2}
    [/event] 
    [event]
        name=moveto
        [filter]
            side=1
            x=$keykeeper_stored.x
            y=$keykeeper_stored.y
        [/filter]
        [if]
            [variable]
                name=earth
                numerical_equals=2
            [/variable]
            [then]
                [message]
                    speaker=unit
                    message= _ "We have the keys!"
                [/message]  

                [remove_item]
                    x,y=$keykeeper_stored.x,$keykeeper_stored.y
                [/remove_item]
                [clear_variable]
                    name=keykeeper_stored
                [/clear_variable]

                {VARIABLE Key 10}
                {VARIABLE earth 0}
            [/then]
        [/if]
    [/event] 


    
    ##############
    ##SECOND KEY##
    ##############


    # DOOR 9
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=15,16
            y=6,5
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=10
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=16,6
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=16,6
                [/terrain]

                [redraw]
                [/redraw]
                [redraw]
                    side=1
                [/redraw]

                {VARIABLE Key 11}
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=15,16
            y=6,5
        [/filter]
        [if]
            [variable]
                name=Key
                less_than=10
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "You don't have the proper key to this door."
                [/message]
            [/then]
        [/if]
    [/event]
    
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=12,13,14,15
            y=9,10,10,11
        [/filter]
        [if]
            [variable]
                name=Prisoner
                less_than_equal_to=2
            [/variable]
            [then]
                [unit]
                    id=Raven
                    name= _ "Raven Jack"
                    unrenamable=yes
                    type=Prisoner
                    profile="portraits/prisoners/raven-prisoner.png"
                    side=3
                    overlays=misc/hero-icon.png
                    x=9
                    y=8
                    [modifications]
                        {TRAIT_LOYAL}
                        {TRAIT_STRONG}
                    [/modifications]
                [/unit]

                [redraw]
                    side=1
                [/redraw]
                [redraw]
                    side=3
                [/redraw] 

                [message]
                    speaker=Raven
                    message= _ "Hey! I'm here! Help!"
                [/message]
                [message]
                    speaker=Aethyr
                    message= _ "Oh my God, what kind of creature are you?"
                [/message]
                [message]
                    speaker=Raven
                    message= _ "Greetings! My name is Raven Jack. Half man, half gryphon."
                [/message]
                [message]
                    speaker=Aethyr
                    message= _ "Whose side are you on?"
                [/message]
                [message]
                    speaker=Raven
                    message= _ "I was locked up because I had murdered a family in Westin. I'm against Wesnoth."
                [/message]
                [message]
                    speaker=Aethyr
                    message= _ "Then you're with us, aren't ya?"
                [/message]
                [message]
                    speaker=Raven
                    message= _ "Yep. And I know where the keys and your equipment are."
                [/message]

                {VARIABLE Prisoner 3}
            [/then]
        [/if]
    [/event]


    #DOOR 10
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=12
            y=9
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=11
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=11,9
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=11,9
                [/terrain]

                [redraw]
                [/redraw]
                [redraw]
                    side=1
                [/redraw]

                {MODIFY_UNIT (id=Raven) side 1}

                [message]
                    speaker=Raven
                    message= _ "Thank you very much. The key which opens the main gate is guarded by the jail master. You have already met him if I saw well. I'm not sure where he is at the moment. He can be in the Headmaster's office, in his own office, or in the Great Room. The key that opens the gate to the Great Room is in the Headmaster's office, which is right here, next to my cell. Your horse and equipment are in the Great Room too."
                [/message]
                [message]
                    speaker=Aethyr
                    message= _ "Thanks."
                [/message]

                [label]
                    text="Headmaster's Office"
                    x,y=4,9
                    visible_in_shroud=yes
                [/label]
                [label]
                    text="Jail Master's Office"
                    x,y=10,17
                    visible_in_shroud=yes
                [/label]
                [label]
                    text="Great Room"
                    x,y=11,13
                    visible_in_shroud=yes
                [/label]
                [label]
                    text="Main Gate"
                    x,y=13,6
                    visible_in_shroud=yes
                [/label]

                {VARIABLE Key 12}
            [/then]
        [/if]
    [/event]



    # DOOR 11
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=6,7
            y=8,9
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=12
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=6,9
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=6,9
                [/terrain]

                [redraw]
                [/redraw]
                [redraw]
                    side=1
                [/redraw]

                [message]
                    speaker=unit
                    message= _ "Hmm...he's not there. But the keys are, right on the desk."
                [/message]

                {VARIABLE Key 13}
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        [filter]
            side=1
            x=4
            y=10
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=13
            [/variable]
            [then]
                [message]
                    speaker=unit
                    message= _ "We have the keys!"
                [/message]  

                {VARIABLE Key 14}
            [/then]
        [/if]
    [/event] 


    #############
    ##THIRD KEY##
    #############
    # DOOR 12
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=14,15
            y=10,11
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=14
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=14,11
                [/remove_item]

                [item]
                    image=units/npc/workhorse.png
                    x,y=8,11
                [/item]
                [item]
                    image=items/armor.png
                    x,y=7,12
                [/item]
                [item]
                    image=items/staff.png
                    x,y=9,11
                [/item]

                [terrain]
                    terrain=Rr
                    x,y=14,11
                [/terrain]

                [redraw]
                [/redraw]
                [redraw]
                    side=1
                [/redraw]

                [message]
                    speaker=Aethyr
                    message= _ "Finally. I shall get changed now."
                [/message]
                {VARIABLE Key 15}
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=14,15
            y=10,11
        [/filter]
        [if]
            [variable]
                name=Key
                less_than=14
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "You don't have the proper key to this door."
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Aethyr
            x=7,8,9,8,9
            y=12,11,11,12,12
        [/filter]
        [if]
            [variable]
                name=Aethyr
                numerical_equals=2
            [/variable]
            [then]

                [remove_item]
                    x,y=7,12
                [/remove_item]
                [remove_item]
                    x,y=8,11
                [/remove_item]
                [remove_item]
                    x,y=9,11
                [/remove_item]

                [store_unit]
                    [filter]
                        id=Aethyr
                    [/filter]

                    kill=yes
                    variable=back_store
                [/store_unit]

                {VARIABLE stored_Aethyr.experience $back_store.experience}
                {VARIABLE stored_Aethyr.moves $back_store.moves}
                {VARIABLE stored_Aethyr.trait_description $back_store.trait_description}
#ifdef HARD
                {VARIABLE stored_Aethyr.hitpoints $back_store.hitpoints}
#endif

                [unstore_unit]
                    variable=stored_Aethyr
                    x,y=9,12
                    find_vacant=no
                [/unstore_unit]
                [clear_variable]
                    name=back_store
                [/clear_variable]

#ifdef EASY
                {FULL_HEAL id=Aethyr}
#endif

                [redraw]
                [/redraw]

                [delay]
                    time=400
                [/delay]

                [message]
                    speaker=Warwick
                    message= _ "So? How's that?"
                [/message]
                [message]
                    speaker=Aethyr
                    message= _ "We're lucky that this prison is high enough, elseway I'd be able to hit my head. Okay, let's keep on seeking for the keys to the main gate."
                [/message]

                {VARIABLE Aethyr 3}
            [/then]
        [/if]
    [/event]

    
    
    # DOOR 13
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=8
            y=14
        [/filter]
        [if]
            [variable]
                name=Aethyr
                numerical_equals=3
            [/variable]
            [and]
            [variable]
                name=Key
                numerical_equals=15
            [/variable]
            [/and]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=7,15
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=7,15
                [/terrain]


                [item]
                    image=deads/humans/Thief-dead.png
                    x,y=5,16
                [/item]

                [redraw]
                [/redraw]
                [redraw]
                    side=1
                [/redraw]

                [message]
                    speaker=Aethyr
                    message= _ "Oh...yuk, what a stink! He must have been dead for weeks."
                [/message]
                [message]
                    speaker=Raven
                    message= _ "He was my brother! The Jail Master killed him! He was suffering a lot. I promised revenge."
                [/message]
                [message]
                    speaker=Aethyr
                    message= _ "You will have opportunity to have it, I promise."
                [/message]
                {VARIABLE Key 16}
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=8
            y=14
        [/filter]
        [if]
            [variable]
                name=Aethyr
                less_than=3
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/armor.png
                    message= _ "You are not equipted properly."
                [/message]
            [/then]
        [/if]
    [/event]

 
    # DOOR 14
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=7,8
            y=17,16
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=16
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=8,17
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=8,17
                [/terrain]

                [redraw]
                [/redraw]
                [redraw]
                    side=1
                [/redraw]

                [message]
                    speaker=Jail
                    message= _ "What do you want...hey! How? What? Guards! Guards!"
                [/message]
                [message]
                    speaker=Raven
                    message= _ "You are screaming in vain! You'll be dead in 2 minutes!"
                [/message]
                {VARIABLE Key 17}
            [/then]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Jail
        [/filter]
        [message]
            speaker=Jail
            message= _ "Okay! Kill me! When the guards see my corpse, they will know that you escaped, and they will find and kill you!"
        [/message]
 
        [delay]
            time=1400
        [/delay]

        [message]
            speaker=Jail
            message= _ "Oh, why are you all silent? You aren't scared, are you?"
        [/message]
        [message]
            speaker=Raven
            message= _ "We aren't. We are just thinking about which part of your body to cut first, which second, et cetera."
        [/message]
        [message]
            speaker=Jail
            message= _ "Oh!"
        [/message]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message= _ "The Jail Master suffered a lot before he died. Raven cut off his head by mistake."
        [/message]

        [store_unit]
            [filter]
                id=Jail
            [/filter]
         
            kill=yes
            variable=jail_store
        [/store_unit]
        
        [item]
            image=items/key.png
            x,y=$jail_store.x,$jail_store.y
        [/item]


        [message]
            speaker=Aethyr
            message= _ "He dropped the keys. Take them, and get away!"
        [/message]
        
        {VARIABLE Key 18}
    [/event]
    
    [event]
        name=moveto
        [filter]
            x=$jail_store.x
            y=$jail_store.y
        [/filter]
        [message]
            speaker=unit
            message= _ "We have the keys! Now, we can escape!"
        [/message]

        [remove_item]
            x,y=$jail_store.x,$jail_store.y
        [/remove_item]
        [clear_variable]
            name=jail_store
        [/clear_variable]

        {VARIABLE Key 19}
    [/event]

    [event]
        name=moveto
        [filter]
            x=12
            y=18
            side=1
        [/filter]

        {GAME_LUCK_DEPENDENCE 
            (
                [set_variable]
                    name=chest_coins
                    rand=100..300
                [/set_variable]
            )
            (
                [set_variable]
                    name=chest_coins
                    rand=150..250
                [/set_variable]
            )
            (
                [set_variable]
                    name=chest_coins
                    rand=180..220
                [/set_variable]
            )
        }




        [message]
            speaker=unit
            message= _ "I count around...$chest_coins coins!"
        [/message]
        [gold]
            side=1
            amount=$chest_coins
        [/gold]
        [remove_item]
            x,y=12,18
        [/remove_item]
        {CLEAR_VARIABLE chest_coins}
    [/event]




    # DOOR 15
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=15,16
            y=15,14
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=19
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=16,15
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=16,15
                [/terrain]

                {VARIABLE Key 20}
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=15,16,17
            y=15,14,16
        [/filter]
        [if]
            [variable]
                name=Key
                less_than=19
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "You don't have the proper key to this door."
                [/message]
            [/then]
        [/if]
    [/event]


    
    # DOOR 16 - Main Gate
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=14
            y=6
        [/filter]
        [if]
            [variable]
                name=Key
                numerical_equals=19
            [/variable]
            [or]
            [variable]
                name=Key
                numerical_equals=20
            [/variable]
            [/or]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "As you put in, and revolve the key, the door suddenly opens."
                [/message]
 
                [sound]
                    name=flail-miss.ogg
                [/sound]
             
                [remove_item]
                    x,y=13,6
                [/remove_item]

                [terrain]
                    terrain=Rr
                    x,y=13,6
                [/terrain]

                [redraw]
                [/redraw]
                [redraw]
                    side=1
                [/redraw]

                {VARIABLE Key 21}

#ifdef EASY
                [message]
                    speaker=Money
                    message= _ "Your little trip is over."
                [/message]
                [message]
                    speaker=Aethyr
                    message= _ "Oh no! We can't fight against a halberdier!"
                [/message]
                [message]
                    speaker=Money
                    image=portraits/money.png
                    message= _ "Sorry, I was mistaken. Your little trip WOULD be over, if I hadn't obtained this purse with full of coins. Your way is free."
                [/message]

                {MODIFY_UNIT (id=Money) side 3}
                {MOVE_UNIT id=Money 9 5}
#endif
#ifdef HARD
                [message]
                    speaker=Money
                    message= _ "Your little trip is over."
                [/message]
                [message]
                    speaker=Aethyr
                    message= _ "You're mistaken mate. YOUR little life is over. Attack!"
                [/message]
#endif
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=14
            y=6
        [/filter]
        [if]
            [variable]
                name=Key
                less_than=19
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "You don't have the proper key to this door."
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=die
        [filter]
            id=Money
        [/filter]
        [message]
            speaker=Aethyr
            message= _ "We have the keys! All right, get out of here!"
        [/message]

        {VARIABLE Key 22}
    [/event]
        


    # ?DOOR 17
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=10
            y=4
        [/filter]
#ifdef EASY
        [message]
            speaker=narrator
            image=items/key.png
            message= _ "As you put in, and revolve the key, the door suddenly opens."
        [/message]
 
        [sound]
            name=flail-miss.ogg
        [/sound]
             
        [remove_item]
              x,y=9,4
        [/remove_item]

        [terrain]
            terrain=Rr
            x,y=9,4
        [/terrain]

        {MODIFY_UNIT (id=Arya) side 3}

        [redraw]
        [/redraw]
        [redraw]
            side=1
        [/redraw]
        [redraw]
            side=3
        [/redraw]

        [message]
            speaker=Arya
            message= _ "Hi. So, you succeeded. I see you have company too. Well done."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "Hello...yeah...thanks...but may I ask why?"
        [/message]
        [message]
            speaker=Arya
            message= _ "What why? We saved each other's life and that's all."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "Yes, you're right. So we're enemies again."
        [/message]
        [message]
            speaker=Arya
            message= _ "I don't follow you...why would we be enemies?"
        [/message]
        [message]
            speaker=Aethyr
            message= _ "I mean on the battlefield."
        [/message]
        [message]
            speaker=Arya
            message= _ "Ah, I understand...yes, unfortunately, we are enemies. But I think we don't have to be. We can be allies. Do you want to fight on Lawrence's side by all means?"
        [/message]
        [message]
            speaker=Aethyr
            message= _ "*<i>smiles</i>* You don't know the western traditions. We gotta fight."
        [/message]
        [message]
            speaker=Arya
            message= _ "*<i>smiles back</i>* Yeah, I don't know the westerns. Look, you should hurry now, it's almost dawn."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "We're vanished in 2 seconds. When can we meet again?"
        [/message]
        [message]
            speaker=Arya
            message= _ "*<i>laughs</i>* Pray for we do NOT meet! If we met, that would be on the battlefield, and I don't want to kill you, I hope you don't want me either."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "Of course not."
        [/message]
        [delay]
            time=1500
        [/delay]
        [message]
            speaker=Arya
            message= _ "Well...we can meet before battles...or after, but that would have loads of disadvantages. I will be there in Elensefar for one more week, after that we attach to the King's Army. You can find me there."
        [/message]

        [terrain]
            terrain=Rr
            x,y=17,20
        [/terrain]
        [terrain]
            terrain=Rr
            x,y=17,21
        [/terrain]
        [redraw]
        [/redraw]

        [unit]
            type=Halberdier
            id=Hangman
            profile=portraits/hangman.png
            side=2
            {IS_LOYAL}
            name= _ "Hangman"
            x=17
            y=20
        [/unit]
        
        {MOVE_UNIT id=Hangman 18 18}

        [message]
            speaker=Hangman
            message= _ "What the hell? He escaped! Sound alarm!!!"
        [/message]

        [message]
            speaker=Warwick
            message= _ "I don't wanna spoil your talking, but I would like to warn you about that the hangman has noticed that we escaped and he is blowing the alarm."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "Okay, hop it!"
        [/message]
        
        {MOVE_UNIT id=Aethyr 1 1}
 
        [endlevel]
            result=victory
            carryover_percentage=100%
        [/endlevel]
#endif
#ifdef HARD
        [if]
            [variable]
                name=Key
                numerical_equals=22
            [/variable]
            [then]
        [message]
            speaker=narrator
            image=items/key.png
            message= _ "As you put in, and revolve the key, the door suddenly opens."
        [/message]
 
        [sound]
            name=flail-miss.ogg
        [/sound]
             
        [remove_item]
              x,y=9,4
        [/remove_item]

        [terrain]
            terrain=Rr
            x,y=9,4
        [/terrain]

        {MODIFY_UNIT (id=Arya) side 3}

        [redraw]
        [/redraw]
        [redraw]
            side=1
        [/redraw]
        [redraw]
            side=3
        [/redraw]

        [message]
            speaker=Arya
            message= _ "Hi. So, you succeeded. I see you have company too. Well done."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "Hello...yeah...thanks...but may I ask why?"
        [/message]
        [message]
            speaker=Arya
            message= _ "What why? We saved each other's life and that's all."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "Yes, you're right. So we're enemies again."
        [/message]
        [message]
            speaker=Arya
            message= _ "I don't follow you...why would we be enemies?"
        [/message]
        [message]
            speaker=Aethyr
            message= _ "I mean on the battlefield."
        [/message]
        [message]
            speaker=Arya
            message= _ "Ah, I understand...yes, unfortunately, we are enemies. But I think we don't have to be. We can be allies. Do you wan't to fight on Lawrence's side by all means?"
        [/message]
        [message]
            speaker=Aethyr
            message= _ "*<i>smiles</i>* You don't know the western traditions. We gotta fight."
        [/message]
        [message]
            speaker=Arya
            message= _ "*<i>smiles back</i>* Yeah, I don't know the westerns. Look, you should hurry now, it's almost dawn."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "We're vanished in 2 seconds. When can we meet again?"
        [/message]
        [message]
            speaker=Arya
            message= _ "*laughs* Pray for we do NOT meet! If we met, that would be on the battlefield, and I don't want to kill you, I hope you don't want me either."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "Of course not."
        [/message]
        [delay]
            time=1500
        [/delay]
        [message]
            speaker=Arya
            message= _ "Well...we can meet before battles...or after, but that would have loads of disadvantages. I will be there in Elensefar for one more week, after that we attach to the King's Army. You can find me there."
        [/message]

        [terrain]
            terrain=Rr
            x,y=17,20
        [/terrain]
        [terrain]
            terrain=Rr
            x,y=17,21
        [/terrain]
        [redraw]
        [/redraw]

        [unit]
            type=Halberdier
            id=Hangman
            side=2
            {IS_LOYAL}
            name= _ "Hangman"
            x=17
            y=20
        [/unit]
        
        {MOVE_UNIT id=Hangman 18 18}

        [message]
            speaker=Hangman
            message= _ "What the hell? He escaped! Sound alarm!!!"
        [/message]

        [message]
            speaker=Warwick
            message= _ "I don't wanna spoil your talking, but I would like to warn you about that the hangman has noticed that we escaped and he is blowing the alarm."
        [/message]
        [message]
            speaker=Aethyr
            message= _ "Okay, hop it!"
        [/message]
        
        {MOVE_UNIT id=Aethyr 1 1}
 
        [endlevel]
            result=victory
            carryover_percentage=100%
        [/endlevel]

            [/then]
        [/if]
        [if]
            [variable]
                name=Key
                less_than=21
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=items/key.png
                    message= _ "You don't have the proper key to this door."
                [/message]
            [/then]
        [/if]
#endif
    [/event]








    ##################
    ##Taking Weapons##
    ##################
    # Aethyr's
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Aethyr
            x=27
            y=1
        [/filter]
        [if]
            [variable]
                name=Aethyr
                numerical_equals=0
            [/variable]
            [then]

                [message]
                    speaker=Aethyr
                    image=portraits/aethyr-light.png
                    message= _ "Does it fit?"
                [/message]
                
                [if]
                    [variable]
                        name=Warwick
                        numerical_equals=0
                    [/variable]
                    [then]
                        [message]
                            speaker=Warwick
                            message= _ "Better than the prisoner clothing."
                        [/message]
                    [/then]
                    [else]
                        [message]
                            speaker=Warwick
                            image=portraits/warwick.png
                            message= _ "Better than the prisoner clothing."
                        [/message]
                    [/else]
                [/if]

                {VARIABLE Aethyr 1}
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Aethyr
            x=28
            y=1
        [/filter]
        [if]
            [variable]
                name=Aethyr
                numerical_equals=1
            [/variable]
            [then]
                [store_unit]
                    [filter]
                         id=Aethyr
                    [/filter]

                    kill=yes
                    variable=aethyr_store
                [/store_unit]
                [unit]
                    id=Aethyr
                    name= _ "Aethyr"
                    type=Spearman
                    hitpoints=$aethyr_store.hitpoints
                    profile=portraits/aethyr-light.png
                    experience=$aethyr_store.experience
                    moves=$aethyr_store.moves
                    overlays=misc/leader.png
                    side=1
                    x,y=$aethyr_store.x,$aethyr_store.y
                    [modifications]
                        {TRAIT_STRONG}
                    [/modifications]
                [/unit]

                {MODIFY_UNIT (id=Aethyr) canrecruit yes}
                
                [message]
                    speaker=Aethyr
                    message= _ "I'm not a spearman, so we will need to find my original belongings."
                [/message]

                {VARIABLE Aethyr 2}
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Aethyr
            x=28
            y=1
        [/filter]
        [if]
            [variable]
                name=Aethyr
                numerical_equals=0
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You have to have armour to take a weapon."
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Aethyr
            x=30
            y=2
        [/filter]
        [if]
            [variable]
                name=Aethyr
                numerical_equals=0
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You are not fit enough to wear a heavy armour. You need a lighter one."
                [/message]
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Aethyr
            x=30
            y=2
        [/filter]
        [if]
            [variable]
                name=Aethyr
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You can't wear more than one armour at the same time."
                [/message]
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Aethyr
            x=30
            y=2
        [/filter]
        [if]
            [variable]
                name=Aethyr
                numerical_equals=2
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You don't need any more equipment."
                [/message]
            [/then]
        [/if]
    [/event]   

    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Aethyr
            x=30
            y=3
        [/filter]
        [if]
            [variable]
                name=Aethyr
                numerical_equals=0
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You have to have armour to take a weapon."
                [/message]
            [/then]
        [/if]
    [/event]   
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Aethyr
            x=30
            y=3
        [/filter]
        [if]
            [variable]
                name=Aethyr
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You are unable to handle a glaive. You need something that is similar to a lance."
                [/message]
            [/then]
        [/if]
    [/event]   
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Aethyr
            x=30
            y=3
        [/filter]
        [if]
            [variable]
                name=Aethyr
                numerical_equals=2
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You can't carry two weapons, it's too heavy."
                [/message]
            [/then]
        [/if]
    [/event]   

    ###########
    ##Warwick's
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Warwick
            x=27
            y=1
        [/filter]
        [if]
            [variable]
                name=Warwick
                numerical_equals=0
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "A light armour doesn't defend you enough. You need a stronger one."
                [/message]
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Warwick
            x=27
            y=1
        [/filter]
        [if]
            [variable]
                name=Warwick
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You can't wear more than one armour at the same time."
                [/message]
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Warwick
            x=27
            y=1
        [/filter]
        [if]
            [variable]
                name=Warwick
                numerical_equals=2
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You don't need any more equipment."
                [/message]
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Warwick
            x=28
            y=1
        [/filter]
        [if]
            [variable]
                name=Warwick
                numerical_equals=0
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You have to have armour to take a weapon."
                [/message]
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Warwick
            x=28
            y=1
        [/filter]
        [if]
            [variable]
                name=Warwick
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You are unable to handle a spear. You need a heavy weapon."
                [/message]
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Warwick
            x=28
            y=1
        [/filter]
        [if]
            [variable]
                name=Warwick
                numerical_equals=2
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You can't carry two weapons, it's too heavy."
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Warwick
            x=30
            y=2
        [/filter]
        [if]
            [variable]
                name=Warwick
                numerical_equals=0
            [/variable]
            [then]
                
                [message]
                    speaker=Warwick
                    image=portraits/warwick.png
                    message= _ "Wow! I got quite unused to wear a heavy armour!"
                [/message]
                [remove_item]
                    x,y=2,30
                [/remove_item]

                {VARIABLE Warwick 1}
                 
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Warwick
            x=30
            y=3
        [/filter]
        [if]
            [variable]
                name=Warwick
                numerical_equals=0
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "You have to have armour to take a weapon."
                [/message]
            [/then]
        [/if]
    [/event]   
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Warwick
            x=30
            y=3
        [/filter]
        [if]
            [variable]
                name=Warwick
                numerical_equals=1
            [/variable]
            [then]

                [store_unit]
                    [filter]
                         id=Warwick
                    [/filter]

                    kill=yes
                    variable=warwick_store
                [/store_unit]
                [unit]
                    id=Warwick
                    name= _ "Warwick"
                    type=Heavy Infantry Lieutenant
                    hitpoints=$warwick_store.hitpoints
                    profile=portraits/warwick.png
                    experience=$warwick_store.experience
                    moves=$warwick_store.moves
                    overlays=misc/hero-icon.png
                    side=1
                    x,y=$warwick_store.x,$warwick_store.y
                    [modifications]
                        {TRAIT_LOYAL}
                        {TRAIT_STRONG}
                    [/modifications]
                [/unit]
                
                [message]
                    speaker=Warwick
                    message= _ "Excellent!"
                [/message]
                [remove_item]
                    x,y=3,30
                [/remove_item]

                {VARIABLE Warwick 2}
            [/then]
        [/if]
    [/event]   


    #########
    ##DEADS##
    #########

    [event]
        name=last breath
        [filter]
            id=Warwick
        [/filter]
        [message]
            speaker=Warwick
            message= _ "Ugh...I won't escape now!"
        [/message]
        [message]
            speaker=Aethyr
            message= _ "We're all lost without you!"
        [/message]
        {DEFEAT}
    [/event]

    [event]
        name=last breath
        [filter]
            id=Raven
        [/filter]
        [message]
            speaker=Raven
            message= _ "Ugh...I won't have revenge now!"
        [/message]
        [message]
            speaker=Aethyr
            message= _ "We're all lost without you!"
        [/message]
        {DEFEAT}
    [/event]

    [event]
        name=last breath
        [filter]
            id=Aethyr
        [/filter]
        [message]
            speaker=Aethyr
            message= _ "Ugh...I'll never see again the commodore, Arya, or my beautiful home, the West! Don't get deprest! Carry on fighting despite being without me!"
        [/message]
        [message]
            speaker=Warwick
            message= _ "Fight without a leader? Impossible. Than we're defeated."
        [/message]
        {DEFEAT}
    [/event]

    [event]
        name=victory
        {CLEAR_VARIABLE Key,Aethyr,Warwick,earth,Prisoner}
    [/event]
[/scenario]
