#textdomain wesnoth
#
# Lot's of pickable item, or rather a lot's of items.
# I made them after I had written the 'Waiting For Gallows' scenario.
# But I borrowed the idea from data/core/macros/items.cfg


#ANIMATIONS#
#define ANIMATED_FLAG X Y
    [terrain_graphics]
        x={X}
        y={Y}
        [tile]
            x=0
            y=0
            [image]
                layer=0
                # wmlscope: start ignoring
                name="../flags/SG-flag-1.png:140,../flags/SG-flag-2.png:140,../flags/SG-flag-3.png:140,../flags/SG-flag-4.png:140"
                # wmlscope: stop ignoring
            [/image]
        [/tile]
    [/terrain_graphics]
#enddef


# _UNUSED_!

#define OBJ_LANCE_OF_THE_DEVIL X Y ID

    [event]
        name=prestart
        {VARIABLE lance_of_the_devil_picked_up 0}
    [/event]
    [item]
        x={X}
        y={Y}
        image=items/spear-fancy.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [if]
            [variable]
                name=lance_of_the_devil_picked_up
                numerical_equals=0
            [/variable]  
            [then]

                {VARIABLE lance_of_the_devil_picked_up 1}
                [object]
                    id={ID}
                    name= _ "Lance of the Devil"
                    image=attacks/lance.png
                    duration=forever
                    description= _ "A big, magic Lance, which was owned by the Devil if the story is true. The most powerful weapon in the whole game."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=new_attack
                        name=lance
                        description= _ "lance of the devil"
                        icon=attacks/lance.png
                        type=pierce
                        range=melee
                        [specials]
                            {WEAPON_SPECIAL_CHARGE}
                            {WEAPON_SPECIAL_MAGICAL}
                            {WEAPON_SPECIAL_FIRSTSTRIKE}
                        [/specials]
                        damage=30
                        number=5
                    [/effect]
                    [effect]
                         apply_to=hitpoints
                         increase_total=10
                    [/effect]
                [/object]
            [/then]
        [/if]
    [/event]
#enddef








#############
## WEAPONS ##


## Swords ##

#define WEAPON_KNIFE X Y ID
    [item]
        x={X}
        y={Y}
        image=items/knife.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [object]
            id={ID}
            name= _ "Knife"
            image=attacks/dagger-human.png
            duration=forever
            description= _ "A fruit knife! 'Who has lost it?' you wonder. Well, from this moment, the knife is yours."
            cannot_use_message= _ "You are not worthy of a fruit knife."
            [filter]
                x={X}
                y={Y}
            [/filter]
            [then]
                [remove_item]
                    x,y={X},{Y}
                [/remove_item]
            [/then]
            [effect]
                apply_to=new_attack
                name=knife
                description= _ "fruit knife"
                icon=attacks/dagger-human.png
                type=pierce
                range=melee
                damage=5
                number=2
            [/effect]
        [/object]
    [/event]
#enddef




#define WEAPON_SWORD X Y ID
    [item]
        x={X}
        y={Y}
        image=items/sword.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [object]
            id={ID}
            name= _ "Simple Sword"
            image=attacks/greatsword-human.png
            duration=forever
            description= _ "Just a simple sword. Don't expect too much from it, but it can help you in some cases."
            cannot_use_message= _ "You are not worthy of a sword."
            [filter]
                x={X}
                y={Y}
            [/filter]
            [then]
                [remove_item]
                    x,y={X},{Y}
                [/remove_item]
            [/then]
            [effect]
                apply_to=new_attack
                name=sword
                description= _ "simple sword"
                icon=attacks/greatsword-human.png
                type=blade
                range=melee
                damage=7
                number=3
            [/effect]
        [/object]
    [/event]
#enddef


#define WEAPON_GREATSWORD X Y ID
    [item]
        x={X}
        y={Y}
        image=items/greatsword.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [store_unit]
            [filter]
                x,y={X},{Y}
            [/filter]

            kill=no
            variable=greatsword_level_2
        [/store_unit]
        [if]
            [variable]
                name=greatsword_level_2.level
                greater_than=1
            [/variable]
            [then]
                [object]
                    id={ID}
                    name= _ "Greatsword"
                    image=attacks/holysword-flipped.png
                    duration=forever
                    description= _ "A human greatsword. It will serve you well, you can trust it."
                    cannot_use_message= _ "You are not worthy of a greatsword. This sword expects level 2."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=new_attack
                        name=sword
                        description= _ "greatsword"
                        icon=attacks/holysword-flipped.png
                        type=blade
                        range=melee
                        damage=11
                        number=4
                    [/effect]
                [/object]
            [/then]
            [else]
                [object]
                    name= _ "Greatsword"
                    image=attacks/holysword-flipped.png
                    description= _ "You are not worthy of a greatsword. This sword expects level 2."
                [/object]
            [/else]
        [/if]

        {CLEAR_VARIABLE greatsword_level_2}
    [/event]
#enddef



#define WEAPON_FLAMINGSWORD X Y ID
    [item]
        x={X}
        y={Y}
        image=items/flame-sword.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [store_unit]
            [filter]
                x,y={X},{Y}
            [/filter]

            kill=no
            variable=flamesword_level_2
        [/store_unit]
        [if]
            [variable]
                name=flamesword_level_2.level
                greater_than=1
            [/variable]
            [then]
                [object]
                    id={ID}
                    name= _ "Flaming Sword"
                    image=attacks/sword-flaming.png
                    duration=forever
                    description= _ "With an orcish flaming sword, you can cut and burn too."
                    cannot_use_message= _ "You are not worthy of a flaming sword. This sword expects level 2."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=new_attack
                        name=sword
                        description= _ "flaming sword"
                        icon=attacks/sword-flaming.png
                        type=blade
                        range=melee
                        damage=10
                        number=3
                    [/effect]
                    [effect]
                        apply_to=new_attack
                        name=sword
                        description= _ "flaming sword"
                        icon=attacks/sword-flaming.png
                        type=fire
                        range=melee
                        damage=10
                        number=3
                    [/effect]
                [/object]
            [/then]
            [else]
                [object]
                    name= _ "Flaming Sword"
                    image=attacks/sword-flaming.png
                    description= _ "You are not worthy of a flaming sword. This sword expects level 2."
                [/object]
            [/else]
        [/if]

        {CLEAR_VARIABLE flamingsword_level_2}
    [/event]
#enddef


## Axes ##
#define WEAPON_AXE X Y ID
    [item]
        x={X}
        y={Y}
        image=items/axe.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [object]
            id={ID}
            name= _ "Simple Axe"
            image=attacks/axe.png
            duration=forever
            description= _ "An axe. It's a bit different from a sword, but you are able to learn how to use it."
            cannot_use_message= _ "You are not worthy of an axe."
            [filter]
                x={X}
                y={Y}
            [/filter]
            [then]
                [remove_item]
                    x,y={X},{Y}
                [/remove_item]
            [/then]
            [effect]
                apply_to=new_attack
                name=axe
                description= _ "axe"
                icon=attacks/axe.png
                type=blade
                range=melee
                damage=7
                number=3
            [/effect]
        [/object]
    [/event]
#enddef

#define WEAPON_HALBERD X Y ID
    [item]
        x={X}
        y={Y}
        image=items/halberd.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [store_unit]
            [filter]
                x,y={X},{Y}
            [/filter]

            kill=no
            variable=halberd_level_2
        [/store_unit]
        [if]
            [variable]
                name=halberd_level_2.level
                greater_than=1
            [/variable]
            [then]
                [object]
                    id={ID}
                    name= _ "Halberd"
                    image=attacks/halberd.png
                    duration=forever
                    description= _ "This halberd has two moods of fighting. You can stab or cut with it."
                    cannot_use_message= _ "You are not worthy of a halberd. This weapon expects level 2."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=new_attack
                        name=halberd
                        description= _ "halberd"
                        icon=attacks/halberd.png
                        type=blade
                        range=melee
                        damage=15
                        number=3
                    [/effect]
                    [effect]
                        apply_to=new_attack
                        name=halberd
                        description= _ "halberd"
                        icon=attacks/halberd.png
                        type=pierce
                        range=melee
                        damage=18
                        number=2
                        [specials]
                            {WEAPON_SPECIAL_FIRSTSTRIKE}
                        [/specials]
                    [/effect]
                [/object]
            [/then]
            [else]
                [object]
                    name= _ "Halberd"
                    image=attacks/halberd.png
                    description= _ "You are not worthy of a halberd. This weapon expects level 2."
                [/object]
            [/else]
        [/if]

        {CLEAR_VARIABLE halberd_level_2}
    [/event]
#enddef


## Bows ##

#define WEAPON_BOW X Y ID
    [item]
        x={X}
        y={Y}
        image=items/bow.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [object]
            id={ID}
            name= _ "Simple Bow"
            image=attacks/bow.png
            duration=forever
            description= _ "It's not too hard to handle it, is it? You need only a few arrows, and you can be a bloodthirsty warrior!"
            cannot_use_message= _ "You are not worthy of a bow."
            [filter]
                x={X}
                y={Y}
            [/filter]
            [then]
                [remove_item]
                    x,y={X},{Y}
                [/remove_item]
            [/then]
            [effect]
                apply_to=new_attack
                name=bow
                description= _ "bow"
                icon=attacks/bow.png
                type=pierce
                range=ranged
                damage=6
                number=3
            [/effect]
        [/object]
    [/event]
#enddef

#define WEAPON_EXECUTER_BOW X Y ID
    [item]
        x={X}
        y={Y}
        image=items/bow-crystal.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [object]
            id={ID}
            name= _ "Executer Bow"
            image=attacks/bow-orcish.png
            duration=forever
            description= _ "This bow is a bit smaller than the human ones. But by this, you can shoot the enemy at the back easier."
            cannot_use_message= _ "You are not worthy of a bow."
            [filter]
                x={X}
                y={Y}
            [/filter]
            [then]
                [remove_item]
                    x,y={X},{Y}
                [/remove_item]
            [/then]
            [effect]
                apply_to=new_attack
                name=bow
                description= _ "executer bow"
                icon=attacks/bow-orcish.png
                type=pierce
                range=ranged
                damage=5
                number=3
                [specials]
                    {WEAPON_SPECIAL_BACKSTAB}
                [/specials]
            [/effect]
        [/object]
    [/event]
#enddef

#define WEAPON_LONGBOW X Y ID
    [item]
        x={X}
        y={Y}
        image=items/bow-elven.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [store_unit]
            [filter]
                x,y={X},{Y}
            [/filter]

            kill=no
            variable=bow_level_2
        [/store_unit]
        [if]
            [variable]
                name=bow_level_2.level
                greater_than=1
            [/variable]
            [then]
                [object]
                    id={ID}
                    name= _ "Longbow"
                    image=attacks/bow-elven-magic.png
                    duration=forever
                    description= _ "This bow needs a stronger arm than the smaller ones, but it can fire the arrow with bigger strength."
                    cannot_use_message= _ "You are not worthy of a bow. This weapon expects level 2."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=new_attack
                        name=bow
                        description= _ "longbow"
                        icon=attacks/bow-elven-magic.png
                        type=pierce
                        range=ranged
                        damage=10
                        number=3
                    [/effect]
                [/object]
            [/then]
            [else]
                [object]
                    name= _ "Longbow"
                    image=attacks/bow-elven-magic.png
                    description= _ "You are not worthy of a longbow. This weapon expects level 2."
                [/object]
            [/else]
        [/if]

        {CLEAR_VARIABLE bow_level_2}
    [/event]
#enddef

#define WEAPON_CROSSBOW X Y ID
    [item]
        x={X}
        y={Y}
        image=items/crossbow.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [store_unit]
            [filter]
                x,y={X},{Y}
            [/filter]

            kill=no
            variable=crossbow_level_2
        [/store_unit]
        [if]
            [variable]
                name=crossbow_level_2.level
                greater_than=1
            [/variable]
            [then]
                [object]
                    id={ID}
                    name= _ "Crossbow"
                    image=attacks/crossbow-undead.png
                    duration=forever
                    description= _ "The advantage of the crossbow is that you don't have to keep it tense with your arm, so you can wind it up harder. But it is also slower."
                    cannot_use_message= _ "You are not worthy of a crossbow. This weapon expects level 2."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=new_attack
                        name=crossbow
                        description= _ "crossbow"
                        icon=attacks/crossbow-undead.png
                        type=pierce
                        range=ranged
                        damage=15
                        number=2
                    [/effect]
                [/object]
            [/then]
            [else]
                [object]
                    name= _ "Crossbow"
                    image=attacks/crossbow-undead.png
                    description= _ "You are not worthy of a crossbow. This weapon expects level 2."
                [/object]
            [/else]
        [/if]

        {CLEAR_VARIABLE crossbow_level_2}
    [/event]
#enddef






############
## ARMORS ##

#define ARMOR_SHADOW_CLOAK X Y ID
    [item]
        x={X}
        y={Y}
        image=items/cloak_shadow.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_shadow_cloak
                not_equals=yes
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_shadow_cloak yes}

                [object]
                    id={ID}
                    name= _ "Shadow Clothing"
                    image=icons/cloak_leather_brown.png
                    duration=forever
                    description= _ "If you take this dark clothing, you will be unable to get spotted at night.

New Ability: Nightstalk"
                    cannot_use_message= _ "You are not worthy of a clothing."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=new_ability
                        [abilities]
                            {ABILITY_NIGHTSTALK}
                        [/abilities]
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]
    [/event]
#enddef





#define ARMOR_CLOAK X Y ID
    [item]
        x={X}
        y={Y}
        image=items/cloak-green.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_cloak
                not_equals=yes
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_cloak yes}

                [object]
                    id={ID}
                    name= _ "Green Clothing"
                    image=icons/dress_silk_green.png
                    duration=forever
                    description= _ "A simple dress. At least you won't catch a cold.

Resistance: cold +5%"
                    cannot_use_message= _ "You are not worthy of a clothing."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            cold=-5
                        [/resistance]
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]
    [/event]
#enddef
#define ARMOR_TUNIC X Y ID
    [item]
        x={X}
        y={Y}
        image=items/scarecrow.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_cloak
                not_equals=yes
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_cloak yes}

                [object]
                    id={ID}
                    name= _ "Simple Tunic"
                    image=icons/tunic_elven.png
                    duration=forever
                    description= _ "A simple tunic. At least you won't catch a cold.

Resistance: cold +5%"
                    cannot_use_message= _ "You are not worthy of a clothing."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            cold=-5
                        [/resistance]
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]
    [/event]
#enddef





#define ARMOR_LEATHER X Y ID
    [item]
        x={X}
        y={Y}
        image=items/dummy-old.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_armor
                less_than=1
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_armor 1}

                [object]
                    id={ID}
                    name= _ "Leather Armor"
                    image=icons/armor_leather.png
                    duration=forever
                    description= _ "A simple leather clothing. It won't defend too much but it's enough to avoid scratches.

Resistance: blade +5%
Resistance: pierce +5%"
                    cannot_use_message= _ "You are not worthy of a light armor."
                    [filter]
                        x={X}
                        y={Y}
                        [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            blade=-5
                            pierce=-5
                        [/resistance]
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]
    [/event]
#enddef

#define ARMOR_LEATHER_METAL X Y ID
    [item]
        x={X}
        y={Y}
        image=items/dummy.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_armor
                less_than=1.5
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_armor 1.5}

                [object]
                    id={ID}
                    name= _ "Studded Leather Armor"
                    image=icons/cuirass_leather_studded.png
                    duration=forever
                    description= _ "A bit better leather clothing. It won't defend too much but it's enough to avoid scratches.

Resistance: blade +8%
Resistance: pierce +8%"
                    cannot_use_message= _ "You are not worthy of a light armor."
                    [filter]
                        x={X}
                        y={Y}
                        [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            blade=-8
                            pierce=-8
                        [/resistance]
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]
    [/event]
#enddef





#define ARMOR_HEAVY X Y ID

    [event]
        name=preload
        {VARIABLE {ID}_picked 0}
    [/event]

    [item]
        x={X}
        y={Y}
        image=items/armor.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_armor
                less_than=2
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                [store_unit]
                    [filter]
                        x,y={X},{Y}
                    [/filter]

                    kill=no
                    variable=heavy_armor_level_2
                [/store_unit]
                [if]
                    [variable]
                        name=heavy_armor_level_2.level
                        greater_than=1
                    [/variable]
                    [and]
                    [variable]
                        name={ID}_picked
                        numerical_equals=0
                    [/variable]
                    [/and]
                    [then]
                        [message]
                            speaker=narrator
                            image=icons/breastplate.png
                            message= _ "This armor is going decrease something in the unit. Do you really want to take it?"
                            [option]
                                message= _ "Yes"
                                [command]

                                    {VARIABLE {ID}_picked 1}

                                    [if]
                                        [variable]
                                            name=heavy_armor_level_2.variables.has_armor
                                            numerical_equals=1
                                        [/variable]
                                        [then]
                                            [object]
                                                id={ID}
                                                name= _ "Heavy Armor"
                                                image=icons/breastplate.png
                                                duration=forever
                                                description= _ "A heavy armor. Now you have pretty good chance to survive the battle.

Resistance: blade +15%
Resistance: pierce +10%
Maximum Movements -1"
                                                cannot_use_message= _ "You are not worthy of a heavy armor."
                                                [filter]
                                                    x={X}
                                                    y={Y}
                                                [/filter]
                                                [then]
                                                    [remove_item]
                                                        x,y={X},{Y}
                                                    [/remove_item]
                                                [/then]
                                                [effect]
                                                    apply_to=resistance
                                                    [resistance]
                                                        blade=-10
                                                        pierce=-5
                                                    [/resistance]
                                                [/effect]
                                                [effect]
                                                    apply_to=movement
                                                    increase=-1
                                                [/effect]
                                            [/object]       
                                        [/then]
                                        [else]
                                            [object]
                                                id={ID}
                                                name= _ "Heavy Armor"
                                                image=icons/breastplate.png
                                                duration=forever
                                                description= _ "A heavy armor. Now you have pretty good chance to survive the battle.

Resistance: blade +15%
Resistance: pierce +10%
Maximum Movements -1"
                                                cannot_use_message= _ "You are not worthy of a heavy armor."
                                                [filter]
                                                    x={X}
                                                    y={Y}
                                                [/filter]
                                                [then]
                                                    [remove_item]
                                                        x,y={X},{Y}
                                                    [/remove_item]
                                                [/then]
                                                [effect]
                                                    apply_to=resistance
                                                    [resistance]
                                                        blade=-15
                                                        pierce=-10
                                                    [/resistance]
                                                [/effect]
                                                [effect]
                                                    apply_to=movement
                                                    increase=-1
                                                [/effect]
                                            [/object]
                                        [/else]
                                    [/if]

                                   {MODIFY_UNIT x,y=$x1,$y1 variables.has_armor 2}
                                [/command]
                            [/option]
                            [option]
                                message= _ "No"
                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=heavy_armor_level_2.level
                        less_than_equal_to=1
                    [/variable]
                    [and]
                    [variable]
                        name={ID}_picked
                        numerical_equals=0
                    [/variable]
                    [/and]
                    [then]
                        [object]
                            name= _ "Heavy Armor"
                            image=icons/breastplate.png
                            description= _ "You are not worthy of a heavy armor. This armor expects level 2."
                        [/object]
                    [/then]
                [/if]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]

        {CLEAR_VARIABLE heavy_armor_level_2}
    [/event]
#enddef


#define ARMOR_LEADER X Y ID

    [event]
        name=preload
        {VARIABLE {ID}_picked 0}
    [/event]

    [item]
        x={X}
        y={Y}
        image=items/armor-golden.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_armor
                less_than=3
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                [store_unit]
                    [filter]
                        x,y={X},{Y}
                    [/filter]

                    kill=no
                    variable=heavy_armor_level_3
                [/store_unit]
                [if]
                    [variable]
                        name=heavy_armor_level_3.level
                        greater_than=2
                    [/variable]
                    [and]
                    [variable]
                        name={ID}_picked
                        numerical_equals=0
                    [/variable]
                    [/and]
                    [then]
                        [message]
                            speaker=narrator
                            image=wesnoth-icon.png
                            message= _ "This armor is going decrease something in the unit. Do you really want to take it?"
                            [option]
                                message= _ "Yes"
                                [command]
                                    [if]
                                        [variable]
                                            name=heavy_armor_level_3.variables.has_armor
                                            numerical_equals=2.5
                                        [/variable]
                                        [then]
                                            [object]
                                                id={ID}
                                                name= _ "Leader's Armor"
                                                image=icons/cuirass_muscled.png
                                                duration=forever
                                                description= _ "Armor of a leader. It stops the arrows and wards every hit off.

Resistance: blade +20%
Resistance: pierce +15%
Resistance: impact +15%
Maximum Movements -1"
                                                cannot_use_message= _ "You are not worthy of a leader's armor."
                                                [filter]
                                                    x={X}
                                                    y={Y}
                                                [/filter]
                                                [then]
                                                    [remove_item]
                                                        x,y={X},{Y}
                                                    [/remove_item]
                                                [/then]
                                                [effect]
                                                    apply_to=resistance
                                                    [resistance]
                                                        blade=-5
                                                        pierce=-5
                                                        impact=-5
                                                    [/resistance]
                                                [/effect]
                                            [/object]
                                        [/then]
                                    [/if]


                                    [if]
                                        [variable]
                                            name=heavy_armor_level_3.variables.has_armor
                                            numerical_equals=2
                                        [/variable]
                                        [then]
                                            [object]
                                                id={ID}
                                                name= _ "Leader's Armor"
                                                image=icons/cuirass_muscled.png
                                                duration=forever
                                                description= _ "Armor of a leader. It stops the arrows and wards every hit off.

Resistance: blade +20%
Resistance: pierce +15%
Resistance: impact +15%
Maximum Movements -1"
                                                cannot_use_message= _ "You are not worthy of a leader's armor."
                                                [filter]
                                                    x={X}
                                                    y={Y}
                                                [/filter]
                                                [then]
                                                    [remove_item]
                                                        x,y={X},{Y}
                                                    [/remove_item]
                                                [/then]
                                                [effect]
                                                    apply_to=resistance
                                                    [resistance]
                                                        blade=-5
                                                        pierce=-5
                                                        impact=-15
                                                    [/resistance]
                                                [/effect]
                                            [/object]
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
                                            name=heavy_armor_level_3.variables.has_armor
                                            numerical_equals=1
                                        [/variable]
                                        [then]
                                            [object]
                                                id={ID}
                                                name= _ "Leader's Armor"
                                                image=icons/cuirass_muscled.png
                                                duration=forever
                                                description= _ "Armor of a leader. It stops the arrows and wards every hit off.

Resistance: blade +20%
Resistance: pierce +15%
Resistance: impact +15%
Maximum Movements -1"
                                                cannot_use_message= _ "You are not worthy of a leader's armor."
                                                [filter]
                                                    x={X}
                                                    y={Y}
                                                [/filter]
                                                [then]
                                                    [remove_item]
                                                        x,y={X},{Y}
                                                    [/remove_item]
                                                [/then]
                                                [effect]
                                                    apply_to=resistance
                                                    [resistance]
                                                        blade=-15
                                                        pierce=-10
                                                        impact=-15
                                                    [/resistance]
                                                [/effect]
                                            [/object]
                                        [/then]
                                    [/if]
                                    [if]
                                        [variable]
                                            name=heavy_armor_level_3.variables.has_armor
                                            less_than=1
                                        [/variable]
                                        [then]
                                            [object]
                                                id={ID}
                                                name= _ "Leader's Armor"
                                                image=icons/cuirass_muscled.png
                                                duration=forever
                                                description= _ "Armor of a leader. It stops the arrows and wards every hit off.

Resistance: blade +20%
Resistance: pierce +15%
Resistance: impact +15%
Maximum Movements -1"
                                                cannot_use_message= _ "You are not worthy of a leader's armor."
                                                [filter]
                                                    x={X}
                                                    y={Y}
                                                [/filter]
                                                [then]
                                                    [remove_item]
                                                        x,y={X},{Y}
                                                    [/remove_item]
                                                [/then]
                                                [effect]
                                                    apply_to=resistance
                                                    [resistance]
                                                        blade=-20
                                                        pierce=-15
                                                        impact=-15
                                                    [/resistance]
                                                [/effect]
                                            [/object]
                                        [/then]
                                    [/if]

                                   {MODIFY_UNIT x,y=$x1,$y1 variables.has_armor 3}
                                [/command]
                            [/option]
                            [option]
                                message= _ "No"
                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]


                [if]
                    [variable]
                        name=heavy_armor_level_3.level
                        less_than_equal_to=2
                    [/variable]
                    [and]
                    [variable]
                        name={ID}_picked
                        numerical_equals=0
                    [/variable]
                    [/and]
                    [then]
                      [object]
                            name= _ "Leader's Armor"
                            image=icons/cuirass_muscled.png
                            description= _ "You are not worthy of a leader's armor. This armor expects level 3."
                        [/object]
                    [/then]
                [/if]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]  

        {CLEAR_VARIABLE heavy_armor_level_3}
    [/event]
#enddef



#define ARMOR_STEEL X Y ID

    [event]
        name=preload
        {VARIABLE {ID}_picked 0}
    [/event]

    [item]
        x={X}
        y={Y}
        image=items/armor.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_armor
                less_than=2.5
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                [store_unit]
                    [filter]
                        x,y={X},{Y}
                    [/filter]

                    kill=no
                    variable=heavy_armor_level_2
                [/store_unit]
                [if]
                    [variable]
                        name=heavy_armor_level_2.level
                        greater_than=1
                    [/variable]
                    [and]
                    [variable]
                        name={ID}_picked
                        numerical_equals=0
                    [/variable]
                    [/and]
                    [then]
                        [message]
                            speaker=narrator
                            image=icons/steel_armor.png
                            message= _ "This armor is going decrease something in the unit. Do you really want to take it?"
                            [option]
                                message= _ "Yes"
                                [command]

                                    {VARIABLE {ID}_picked 1}

                                    [switch]
                                        variable=heavy_armor_level_2.variables.has_armor
                                        [case]
                                            value=1

                                            [object]
                                                id={ID}
                                                name= _ "Steel Armor"
                                                image=icons/steel_armor.png
                                                duration=forever
                                                description= _ "A steel armor. Does not make you undefeatable, but this one is a really modern armor.

Resistance: blade +15%
Resistance: pierce +10%
Resistance: impact +10%
Maximum Movements -1"
                                                cannot_use_message= _ "You are not worthy of a heavy armor."
                                                [filter]
                                                    x={X}
                                                    y={Y}
                                                [/filter]
                                                [then]
                                                    [remove_item]
                                                        x,y={X},{Y}
                                                    [/remove_item]
                                                [/then]
                                                [effect]
                                                    apply_to=resistance
                                                    [resistance]
                                                        blade=-10
                                                        pierce=-5
                                                        impact=-10
                                                    [/resistance]
                                                [/effect]
                                                [effect]
                                                    apply_to=movement
                                                    increase=-1
                                                [/effect]
                                            [/object]       
                                        [/case]
                                        [case]
                                            value=1.5

                                            [object]
                                                id={ID}
                                                name= _ "Steel Armor"
                                                image=icons/steel_armor.png
                                                duration=forever
                                                description= _ "A steel armor. Does not make you undefeatable, but this one is a really modern armor.

Resistance: blade +15%
Resistance: pierce +10%
Resistance: impact +10%
Maximum Movements -1"
                                                cannot_use_message= _ "You are not worthy of a heavy armor."
                                                [filter]
                                                    x={X}
                                                    y={Y}
                                                [/filter]
                                                [then]
                                                    [remove_item]
                                                        x,y={X},{Y}
                                                    [/remove_item]
                                                [/then]
                                                [effect]
                                                    apply_to=resistance
                                                    [resistance]
                                                        blade=-7
                                                        pierce=-2
                                                        impact=-10
                                                    [/resistance]
                                                [/effect]
                                                [effect]
                                                    apply_to=movement
                                                    increase=-1
                                                [/effect]
                                            [/object]       
                                        [/case]
                                    
                                        [else]
                                            # When you hadn't had any armor
                                            [object]
                                                id={ID}
                                                name= _ "Steel Armor"
                                                image=icons/steel_armor.png
                                                duration=forever
                                                description= _ "A steel armor. Does not make you undefeatable, but this one is a really modern armor.

Resistance: blade +15%
Resistance: pierce +10%
Resistance: impact +10%
Maximum Movements -1"
                                                cannot_use_message= _ "You are not worthy of a heavy armor."
                                                [filter]
                                                    x={X}
                                                    y={Y}
                                                [/filter]
                                                [then]
                                                    [remove_item]
                                                        x,y={X},{Y}
                                                    [/remove_item]
                                                [/then]
                                                [effect]
                                                    apply_to=resistance
                                                    [resistance]
                                                        blade=-15
                                                        pierce=-10
                                                        impact=-10
                                                    [/resistance]
                                                [/effect]
                                                [effect]
                                                    apply_to=movement
                                                    increase=-1
                                                [/effect]
                                            [/object]
                                        [/else]
                                    [/switch]




                                   {MODIFY_UNIT x,y=$x1,$y1 variables.has_armor 2.5}
                                [/command]
                            [/option]
                            [option]
                                message= _ "No"
                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=heavy_armor_level_2.level
                        less_than_equal_to=1
                    [/variable]
                    [and]
                    [variable]
                        name={ID}_picked
                        numerical_equals=0
                    [/variable]
                    [/and]
                    [then]
                        [object]
                            name= _ "Heavy Armor"
                            image=icons/breastplate.png
                            description= _ "You are not worthy of a heavy armor. This armor expects level 2."
                        [/object]
                    [/then]
                [/if]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]

        {CLEAR_VARIABLE heavy_armor_level_2}
    [/event]
#enddef







#define ARMOR_GREAVES X Y ID
    [item]
        x={X}
        y={Y}
        image=items/greaves.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_greaves
                not_equals=yes
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_greaves yes}

                [object]
                    id={ID}
                    name= _ "Greaves"
                    image=icons/greaves.png
                    duration=forever
                    description= _ "It won't be so easy to cut your legs off now.

Resistance: blade +10%
Hitpoints: +5%"
                    cannot_use_message= _ "You are not worthy of boots."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            blade=-10
                        [/resistance]
                    [/effect]
                    [effect]
                        apply_to=hitpoints
                        increase_total=5%
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]
    [/event]
#enddef



#define ARMOR_BOOTS X Y ID
    [item]
        x={X}
        y={Y}
        image=items/boots.png
    [/item]


    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_boots
                not_equals=yes
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_boots yes}

                [object]
                    id={ID}
                    name= _ "Boots"
                    image=icons/boots_elven.png
                    duration=forever
                    description= _ "This quality boots won't hurt your sole as the old ones did.

Maximum movements +1"
                    cannot_use_message= _ "You are not worthy of boots."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                        [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=movement
                        increase=1
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]  
    [/event]
#enddef



#define SHIELD_WOODEN X Y ID
    [item]
        x={X}
        y={Y}
        image=items/buckler.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_shield
                less_than=1
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_shield 1}

                [object]
                    id={ID}
                    name= _ "Wooden Shield"
                    image=icons/shield_wooden.png
                    duration=forever
                    description= _ "With a shield you can ward the arrows and the hits off.

Defense +5% on every type of terrain
Resistance: pierce +2%"
                    cannot_use_message= _ "You are not worthy of a shield."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            pierce=-2
                        [/resistance]
                    [/effect]
                    [effect]
                        apply_to=defense
                        [defense]
                            shallow_water=-5
                            reef=-5
                            swamp_water=-5
                            flat=-5
                            sand=-5
                            forest=-5
                            hills=-5
                            mountains=-5
                            village=-5
                            castle=-5
                            cave=-5
                            frozen=-5
                            fungus=-5
                        [/defense]
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]
    [/event]
#enddef


#define SHIELD_METAL X Y ID

    [event]
        name=preload
        {VARIABLE {ID}_picked 0}
    [/event]
    
    [item]
        x={X}
        y={Y}
        image=items/shield.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_shield
                less_than=2
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                [store_unit]
                    [filter]
                        x,y={X},{Y}
                    [/filter]

                    kill=no
                    variable=shield_level_2
                [/store_unit]
                [if]
                    [variable]
                        name=shield_level_2.level
                        greater_than=1
                    [/variable]
                    [and]
                    [variable]
                        name={ID}_picked
                        numerical_equals=0
                    [/variable]
                    [/and]
                    [then]
                        [message]
                            speaker=narrator
                            image=icons/shield_tower.png
                            message= _ "This armor is going decrease something in the unit. Do you really want to take it?"
                            [option]
                                message= _ "Yes"
                                [command]
                                    [if]
                                        [variable]
                                            name=shield_level_2.variables.has_shield
                                            numerical_equals=1
                                        [/variable]
                                        [then]
                                            [object]
                                                id={ID}
                                                name= _ "Metal Shield"
                                                image=icons/shield_tower.png
                                                duration=forever
                                                description= _ "A metal shield. Bigger than the little wooden ones, but unfortunately heavier too...

Defense +10% on every type of terrain
Resistance: pierce +5%
Maximum Movements -1"
                                                cannot_use_message= _ "You are not worthy of a heavy armor."
                                                [filter]
                                                    x={X}
                                                    y={Y}
                                                [/filter]
                                                [then]
                                                    [remove_item]
                                                        x,y={X},{Y}
                                                    [/remove_item]
                                                [/then]
                                                [effect]
                                                    apply_to=resistance
                                                    [resistance]
                                                        pierce=-3
                                                    [/resistance]
                                                [/effect]
                                                [effect]
                                                    apply_to=defense
                                                    [defense]
                                                        shallow_water=-5
                                                        reef=-5
                                                        swamp_water=-5
                                                        flat=-5
                                                        sand=-5
                                                        forest=-5
                                                        hills=-5
                                                        mountains=-5
                                                        village=-5
                                                        castle=-5
                                                        cave=-5
                                                        frozen=-5
                                                        fungus=-5
                                                    [/defense]
                                                [/effect]
                                                [effect]
                                                    apply_to=movement
                                                    increase=-1
                                                [/effect]
                                            [/object]
                                        [/then]
                                        [else]
                                            [object]
                                                id={ID}
                                                name= _ "Metal Shield"
                                                image=icons/shield_tower.png
                                                duration=forever
                                                description= _ "A metal shield. Bigger than the little wooden ones, but unfortunately heavier too...

Defense +10% on every type of terrain
Resistance: pierce +5%
Maximum Movements -1"
                                                cannot_use_message= _ "You are not worthy of a heavy armor."
                                                [filter]
                                                    x={X}
                                                    y={Y}
                                                [/filter]
                                                [then]
                                                    [remove_item]
                                                        x,y={X},{Y}
                                                    [/remove_item]
                                                [/then]
                                                [effect]
                                                    apply_to=resistance
                                                    [resistance]
                                                        pierce=-5
                                                    [/resistance]
                                                [/effect]
                                                [effect]
                                                    apply_to=defense
                                                    [defense]
                                                        shallow_water=-10
                                                        reef=-10
                                                        swamp_water=-10
                                                        flat=-10
                                                        sand=-10
                                                        forest=-10
                                                        hills=-10
                                                        mountains=-10
                                                        village=-10
                                                        castle=-10
                                                        cave=-10
                                                        frozen=-10
                                                        fungus=-10
                                                [/defense]
                                                [/effect]
                                                [effect]
                                                    apply_to=movement
                                                    increase=-1
                                                [/effect]
                                            [/object]
                                        [/else]
                                    [/if]

                                   {MODIFY_UNIT x,y=$x1,$y1 variables.has_shield 2}
                                [/command]
                            [/option]
                            [option]
                                message= _ "No"
                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=shield_level_2.level
                        less_than_equal_to=1
                    [/variable]
                    [and]
                    [variable]
                        name={ID}_picked
                        numerical_equals=0
                    [/variable]
                    [/and]
                    [then] 
                        [object]
                            name= _ "Metal Shield"
                            image=icons/shield_tower.png
                            description= _ "You are not worthy of a metal shield. This shield expects level 2."
                        [/object]
                    [/then]
                [/if]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]

        {CLEAR_VARIABLE shield_level_2}
    [/event]
#enddef



#define HELMET_ELVISH X Y ID
    [item]
        x={X}
        y={Y}
        image=items/helmet-elvish.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_helmet
                not_equals=yes
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_helmet yes}

                [object]
                    id={ID}
                    name= _ "Elvish Helmet"
                    image=icons/helmet_shiny.png
                    duration=forever
                    description= _ "The elvish helmets can fend the swords well.

Resistance: blade +10%"
                    cannot_use_message= _ "You are not worthy of a helmet."
                    [filter]
                        x={X}
                        y={Y}
                        [not]
                            type=Heavy Infantry Lieutenant
                        [/not]
                        [not]
                            type=Heavy Infantry General
                        [/not]
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            blade=-10
                        [/resistance]
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]
    [/event]
#enddef

#define HELMET_ORCISH X Y ID
    [item]
        x={X}
        y={Y}
        image=items/helmet-orcish.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_helmet
                not_equals=yes
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_helmet yes}

                [object]
                    id={ID}
                    name= _ "Orcish Helmet"
                    image=icons/helmet_corinthian.png
                    duration=forever
                    description= _ "The orcish helmets are to defent strong mace hits.

Resistance: impact +10%"
                    cannot_use_message= _ "You are not worthy of a helmet."
                    [filter]
                        x={X}
                        y={Y}
                        [not]
                            type=Heavy Infantry Lieutenant
                        [/not]
                        [not]
                            type=Heavy Infantry General
                        [/not]
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            impact=-10
                        [/resistance]
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]
    [/event]
#enddef

#define HELMET_HUMAN X Y ID
    [item]
        x={X}
        y={Y}
        image=items/helmet-human.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_helmet
                not_equals=yes
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_helmet yes}

                [object]
                    id={ID}
                    name= _ "Human Helmet"
                    image=icons/helmet_conical.png
                    duration=forever
                    description= _ "The human helmets can ward the hits and sword swishes off.

Resistance: blade +5%
Resistance: pierce +5%"
                    cannot_use_message= _ "You are not worthy of a helmet."
                    [filter]
                        x={X}
                        y={Y}
                        [not]
                            type=Heavy Infantry Lieutenant
                        [/not]
                        [not]
                            type=Heavy Infantry General
                        [/not]
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            pierce=-5
                            blade=-5
                        [/resistance]
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]
    [/event]
#enddef


#define HELMET_RIDER X Y ID
    [item]
        x={X}
        y={Y}
        image=items/helmet-rider.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_helmet
                not_equals=yes
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_helmet yes}

                [object]
                    id={ID}
                    name= _ "Rider Helmet"
                    image=icons/helmet_crested.png
                    duration=forever
                    description= _ "The helmets of riders and horsemen are to resist arrows and spears.

Resistance: pierce +10%"
                    cannot_use_message= _ "You are not worthy of a helmet."
                    [filter]
                        x={X}
                        y={Y}
                        [not]
                            type=Heavy Infantry Lieutenant
                        [/not]
                        [not]
                            type=Heavy Infantry General
                        [/not]
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=resistance
                        [resistance]
                            impact=-5
                            blade=-5
                        [/resistance]
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]
    [/event]
#enddef


#define HELMET_KNIGHT X Y ID
    [item]
        x={X}
        y={Y}
        image=items/helmet-knight.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_helmet
                not_equals=yes
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                [store_unit]
                    [filter]
                        x,y={X},{Y}
                    [/filter]
        
                    kill=no
                    variable=helmet_level_2
                [/store_unit]
                [if]
                    [variable]
                        name=helmet_level_2.level
                        greater_than=1
                    [/variable]
                    [then]

                        {MODIFY_UNIT x,y=$x1,$y1 variables.has_helmet yes}
                        [object]
                            id={ID}
                            name= _ "Knight's Helmet"
                            image=icons/helmet_bascinet.png
                            duration=forever
                            description= _ "Helmet for knights. 

Resistance: blade +10%
Resistance: pierce +10%
Resistance: impact +10%"
                            cannot_use_message= _ "You are not worthy of a  helmet."
                            [filter]
                                x={X}
                                y={Y}
                                [not]
                                    type=Heavy Infantry Lieutenant
                                [/not]
                                [not]
                                    type=Heavy Infantry General
                                [/not]
                            [/filter]
                            [then]
                                [remove_item]
                                    x,y={X},{Y}
                                [/remove_item]
                            [/then]
                            [effect]
                                apply_to=resistance
                                [resistance]
                                    blade=-20
                                    pierce=-15
                                    impact=-15
                                [/resistance]
                            [/effect]
                        [/object]
                    [/then]
                    [else]
                        [object]
                            name= _ "Knight's Helmet"
                            image=icons/helmet_bascinet.png
                            description= _ "You are not worthy of a knight's helmet. This helmet expects level 2."
                        [/object]
                    [/else]
                [/if]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]

        {CLEAR_VARIABLE helmet_level_2}
    [/event]
#enddef


#define ARMOR_SNOW_BOOTS X Y ID
    [item]
        x={X}
        y={Y}
        image=items/snow_boots.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [object]
            id={ID}
            name= _ "Snow Boots"
            image=icons/sandals.png
            duration=level
            description= _ "In these boots, you won't slip so easily.

Set your movement costs 'frozen'  to 1"
            cannot_use_message= _ "You are not worthy of boots."
            [filter]
                x={X}
                y={Y}
            [/filter]
            [then]
                [remove_item]
                    x,y={X},{Y}
                [/remove_item]
            [/then]
            [effect]
                apply_to=movement_costs
                replace=true
                [movement_costs]
                    frozen=1
                    snow=1
                [/movement_costs]
            [/effect]
        [/object]
    [/event]
#enddef


###########
# POTIONS #
###########

#define POTION_MORAL X Y ID
    [item]
        x={X}
        y={Y}
        image=items/potion-red.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [object]
            id={ID}
            name= _ "Moral Increaser"
            image=icons/potion_red_medium.png
            duration=level
            description= _ "This hot potion will give back your lust for fighting.

Set unit's moral to 100%"
            cannot_use_message= _ "You are not worthy of this potion."
            [filter]
                x={X}
                y={Y}
            [/filter]
            [then]
                [remove_item]
                    x,y={X},{Y}
                [/remove_item]
                {STORE_UNIT x,y={X},{Y} moral_reset yes}
                {VARIABLE moral_reset.variables.defeats 1}
                {VARIABLE moral_reset.variables.victories 1}

                [unstore_unit]
                    variable=moral_reset
                [/unstore_unit]
                {CLEAR_VARIABLE moral_reset}
            [/then]
        [/object]
    [/event]
#enddef

#define POTION_MIND X Y ID
    [item]
        x={X}
        y={Y}
        image=items/potion-green.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [object]
            id={ID}
            name= _ "Mind Increaser"
            image=icons/potion_green_medium.png
            duration=level
            description= _ "This chilly potion will refresh your brain so that you can think clearly again.

Experience costs -5%"
            cannot_use_message= _ "You are not worthy of this potion."
            [filter]
                x={X}
                y={Y}
            [/filter]
            [then]
                [remove_item]
                    x,y={X},{Y}
                [/remove_item]
            [/then]
            [effect]
                apply_to=max_experience
                increase=-5%
            [/effect]
        [/object]
    [/event]
#enddef

#define POTION_MOVEMENTS X Y ID
    [item]
        x={X}
        y={Y}
        image=items/potion-blue.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [object]
            id={ID}
            name= _ "Pace Increaser"
            image=icons/potion_green_small.png
            duration=level
            description= _ "This vivid potion will make you run run and run.

Max movements +1"
            cannot_use_message= _ "You are not worthy of this potion."
            [filter]
                x={X}
                y={Y}
            [/filter]
            [then]
                [remove_item]
                    x,y={X},{Y}
                [/remove_item]
            [/then]
            [effect]
                apply_to=movement
                increase=1
            [/effect]
        [/object]
    [/event]
#enddef

#define POTION_STRENGTH X Y ID
    [item]
        x={X}
        y={Y}
        image=items/potion-yellow.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [object]
            id={ID}
            name= _ "Strength Increaser"
            image=icons/potion_red_small.png
            duration=level
            description= _ "This strong potion will make your hits stronger.

Melee damage +1"
            cannot_use_message= _ "You are not worthy of this potion."
            [filter]
                x={X}
                y={Y}
            [/filter]
            [then]
                [remove_item]
                    x,y={X},{Y}
                [/remove_item]
            [/then]
            [effect]
                apply_to=attack
                range=melee
                increase_damage=1
            [/effect]
        [/object]
    [/event]
#enddef

#define POTION_POISON X Y ID
    [item]
        x={X}
        y={Y}
        image=items/potion-poison.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]
        [object]
            id={ID}
            name= _ "Poison"
            image=icons/potion_green_medium.png
            duration=level
            description= _ "You just drank poison."
            cannot_use_message= _ "You are not worthy of this potion."
            [filter]
                x={X}
                y={Y}
            [/filter]
            [then]
                [remove_item]
                    x,y={X},{Y}
                [/remove_item]
                {MODIFY_UNIT x,y={X},{Y} status.poisoned yes}
            [/then]
        [/object]
    [/event]
#enddef

##########
##EXTRAS##
##########
#define EXTRA_NECKLACE X Y ID
    [item]
        x={X}
        y={Y}
        image=items/ankh-necklace.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x={X}
            y={Y}
        [/filter]

        {STORE_UNIT x,y=$x1,$y1 unit_taking yes}
        
        [if]
            [variable]
                name=unit_taking.variables.has_necklace
                not_equals=yes
            [/variable]
            [then]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]

                {MODIFY_UNIT x,y=$x1,$y1 variables.has_necklace yes}

                [object]
                    id={ID}
                    name= _ "Necklace Amulett"
                    image=icons/jewelry_necklace_amber.png
                    duration=forever
                    description= _ "An amulatt that is said to bring good luck."
                    cannot_use_message= _ "You are not worthy of a necklace."
                    [filter]
                        x={X}
                        y={Y}
                    [/filter]
                    [then]
                        [remove_item]
                            x,y={X},{Y}
                        [/remove_item]
                    [/then]
                    [effect]
                        apply_to=attack
                        range=melee
                        [set_specials]
                            mode=append
                            {WEAPON_SPECIAL_MARKSMAN}
                        [/set_specials]
                    [/effect]
                [/object]
            [/then]
            [else]
                [unstore_unit]
                    variable=unit_taking
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]
    [/event]
#enddef




##################
##ITEMS, SCENERY##
##################


